<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>DoubleInstanceLock</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="DoubleInstanceLock";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/apriori/concurrent/DeadlockException.html" title="class in com.apriori.concurrent"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/apriori/concurrent/Duration.html" title="class in com.apriori.concurrent"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/apriori/concurrent/DoubleInstanceLock.html" target="_top">Frames</a></li>
<li><a href="DoubleInstanceLock.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.apriori.concurrent</div>
<h2 title="Class DoubleInstanceLock" class="title">Class DoubleInstanceLock&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>com.apriori.concurrent.DoubleInstanceLock&lt;T&gt;</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>T</code> - the type of element that is being accessed by readers and writers</dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">DoubleInstanceLock&lt;T&gt;</span>
extends java.lang.Object</pre>
<div class="block">A concurrency mechanism allowing concurrent readers and an exclusive writer. This is based on the
 technique called <a href="http://concurrencyfreaks.blogspot.com/2013/11/double-instance-locking.html">
 Double Instance Locking</a>. The linked article describes the use of two read-write locks, one
 for each instance, plus another mutex to serialize writes. This implementation uses a custom
 synchronizer that combines all three into one.
 
 <p>Readers never block, even when a write operation is in progress. Essentially, two instances of
 the data are kept (hence the name). Reads all safely happen against one instance while writes
 happen to the other. The two versions are atomically swapped to make changes visible to readers.
 Writers must make the same change to both halves: once to the instance not being read, then again
 to the other side after the instances are swapped.
 
 <p>All write operations must be deterministic, such that applying it to two equal objects
 produces two equal results. Otherwise, when writes are applied to both halves, the state may be
 corrupted and the two instances could get out of sync.
 
 <p>It is important that read and write operations neither return references to the object they
 read/write nor allow such a reference to otherwise "escape" (e.g. storing it in another object
 that ends up publishing the value to other threads). This is because any thread that tries to
 inspect or interact with that value will encounter concurrency issues as the object is not
 thread-safe. The <em>only</em> thread-safe interaction is through this
 <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent"><code>DoubleInstanceLock</code></a>. If an operation needs to provide access to the object, use
 <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#snapshot--"><code>snapshot()</code></a> instead of the read or write methods. Access should always be marshaled so
 as to prevent mutations to the snapshot. 
 
 <p>The object must be cloneable so that stable snapshots of the object can be captured. (Also, it
 is cloned initially to generate the two instances from the one object.) It is <em>very
 important</em> that no operations be performed directly against the object after the
 <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent"><code>DoubleInstanceLock</code></a> is created. All subsequent operations must use read and write methods
 on the <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent"><code>DoubleInstanceLock</code></a> to access the data. Failing to comply can result in corruption
 of the data and undefined behavior.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="http://concurrencyfreaks.blogspot.com/2013/11/double-instance-locking.html">
       Double Instance Locking</a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static &lt;T extends java.lang.Cloneable&gt;<br><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent">DoubleInstanceLock</a>&lt;T&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#newLock-T-">newLock</a></span>(T&nbsp;t)</code>
<div class="block">Constructs a new double instance lock around the given object.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static &lt;T&gt;&nbsp;<a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent">DoubleInstanceLock</a>&lt;T&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#newLock-T-com.apriori.util.Cloner-">newLock</a></span>(T&nbsp;t,
       <a href="../../../com/apriori/util/Cloner.html" title="interface in com.apriori.util">Cloner</a>&lt;T&gt;&nbsp;cloner)</code>
<div class="block">Constructs a new double instance lock around the given object that uses the given cloner to
 create additional instances.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>&lt;U&gt;&nbsp;U</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#read-java.util.function.Function-">read</a></span>(java.util.function.Function&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>,? extends U&gt;&nbsp;action)</code>
<div class="block">Performs a read operation that produces a result value.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#readWith-java.util.function.Consumer-">readWith</a></span>(java.util.function.Consumer&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>&gt;&nbsp;action)</code>
<div class="block">Performs a read operation that does not produce a result value.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#snapshot--">snapshot</a></span>()</code>
<div class="block">Returns a snapshot of the data, like for performing expensive work that requires a strongly
 consistent view.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>&lt;U&gt;&nbsp;U</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#write-java.util.function.Function-">write</a></span>(java.util.function.Function&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>,? extends U&gt;&nbsp;action)</code>
<div class="block">Performs a write operation that produces a result value.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#writeWith-java.util.function.Consumer-">writeWith</a></span>(java.util.function.Consumer&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>&gt;&nbsp;action)</code>
<div class="block">Performs a write operation that does not produce a value.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="newLock-java.lang.Cloneable-">
<!--   -->
</a><a name="newLock-T-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newLock</h4>
<pre>public static&nbsp;&lt;T extends java.lang.Cloneable&gt;&nbsp;<a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent">DoubleInstanceLock</a>&lt;T&gt;&nbsp;newLock(T&nbsp;t)</pre>
<div class="block">Constructs a new double instance lock around the given object. The object's <code>Object.clone()</code>
 method is used to create additional instances.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>t</code> - an object</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a double instance lock around the given object</dd>
</dl>
</li>
</ul>
<a name="newLock-java.lang.Object-com.apriori.util.Cloner-">
<!--   -->
</a><a name="newLock-T-com.apriori.util.Cloner-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newLock</h4>
<pre>public static&nbsp;&lt;T&gt;&nbsp;<a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="class in com.apriori.concurrent">DoubleInstanceLock</a>&lt;T&gt;&nbsp;newLock(T&nbsp;t,
                                                <a href="../../../com/apriori/util/Cloner.html" title="interface in com.apriori.util">Cloner</a>&lt;T&gt;&nbsp;cloner)</pre>
<div class="block">Constructs a new double instance lock around the given object that uses the given cloner to
 create additional instances.
 
 <p><strong>Note</strong>: If the supplied cloner does not properly adhere to the contract,
 (e.g. does not produce a different instance that is otherwise identical to the input object)
 then the two instances of data used by the lock can get out of sync. This means data
 corruption and that subsequent operations will be undefined.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>t</code> - an object</dd>
<dd><code>cloner</code> - a cloner</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a double instance lock around the given object</dd>
</dl>
</li>
</ul>
<a name="readWith-java.util.function.Consumer-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readWith</h4>
<pre>public&nbsp;void&nbsp;readWith(java.util.function.Consumer&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>&gt;&nbsp;action)</pre>
<div class="block">Performs a read operation that does not produce a result value. To maximize write throughput,
 read operations should be very fast. If a read operation needs to do something expensive,
 consider performing the operation on a <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#snapshot--">snapshot</a> instead of using this
 method.
 
 <p><strong>Note</strong>: if the action performs any mutations on the object passed to it,
 this data structure will become corrupted and further operations will produce undefined
 results.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>action</code> - the read operation to perform</dd>
</dl>
</li>
</ul>
<a name="read-java.util.function.Function-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>read</h4>
<pre>public&nbsp;&lt;U&gt;&nbsp;U&nbsp;read(java.util.function.Function&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>,? extends U&gt;&nbsp;action)</pre>
<div class="block">Performs a read operation that produces a result value. To maximize write throughput, read
 operations should be very fast. If a read operation needs to do something expensive, consider
 performing the operation on a <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#snapshot--">snapshot</a> instead of using this method.
 
 <p><strong>Note</strong>: if the action performs any mutations on the object passed to it,
 this data structure will become corrupted and further operations will produce undefined
 results.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>action</code> - the read operation to perform</dd>
</dl>
</li>
</ul>
<a name="writeWith-java.util.function.Consumer-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeWith</h4>
<pre>public&nbsp;void&nbsp;writeWith(java.util.function.Consumer&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>&gt;&nbsp;action)</pre>
<div class="block">Performs a write operation that does not produce a value. Note that write operations are
 <strong>not</strong> allowed to be reentrant. If the given action tries to invoke
 <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#write-java.util.function.Function-"><code>write(Function)</code></a> or <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html#writeWith-java.util.function.Consumer-"><code>writeWith(Consumer)</code></a> then a <a href="../../../com/apriori/concurrent/ReentranceException.html" title="class in com.apriori.concurrent"><code>ReentranceException</code></a>
 is thrown.

 <p><strong>Note</strong>: if the action is not deterministic, then applying the action could
 cause divergence of the two sides of this structure, thus causing corruption and making the
 results of subsequent operations undefined.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>action</code> - the write operation to perform</dd>
</dl>
</li>
</ul>
<a name="write-java.util.function.Function-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;&lt;U&gt;&nbsp;U&nbsp;write(java.util.function.Function&lt;? super <a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>,? extends U&gt;&nbsp;action)</pre>
<div class="block">Performs a write operation that produces a result value.

 <p><strong>Note</strong>: if the action is not deterministic, then applying the action could
 cause divergence of the two sides of this structure, thus causing corruption and making the
 results of subsequent operations undefined.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>action</code> - the write operation to perform</dd>
</dl>
</li>
</ul>
<a name="snapshot--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>snapshot</h4>
<pre>public&nbsp;<a href="../../../com/apriori/concurrent/DoubleInstanceLock.html" title="type parameter in DoubleInstanceLock">T</a>&nbsp;snapshot()</pre>
<div class="block">Returns a snapshot of the data, like for performing expensive work that requires a strongly
 consistent view.

 <p><strong>Note</strong>: the returned object <em>should not be modified in anyway</em>. For
 efficiency, creation of the snapshot is deferred to when a writer needs to modify the object.
 This allows multiple readers to share snapshots. Mutating the returned object will corrupt the
 data for other readers and result in undefined behavior for subsequent operations.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a snapshot of the data that will not be modified by subsequent write operations</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../com/apriori/concurrent/DeadlockException.html" title="class in com.apriori.concurrent"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../com/apriori/concurrent/Duration.html" title="class in com.apriori.concurrent"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/apriori/concurrent/DoubleInstanceLock.html" target="_top">Frames</a></li>
<li><a href="DoubleInstanceLock.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
